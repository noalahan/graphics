var g_map = [
  [
    5, 4, 3, 3, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
    2, 2, 2, 3, 3, 4, 6,
  ],
  [
    4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 4,
  ],
  [
    3, 0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
    2, 2, 2, 2, 2, 0, 3,
  ],
  [
    3, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 2, 0, 3,
  ],
  [
    2, 0, 2, 0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 0, 2, 2, 2, 2, 2, 2, 2, 2,
    2, 2, 2, 0, 2, 0, 2,
  ],
  [
    2, 0, 2, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 2, 0, 2, 0, 2,
  ],
  [
    2, 0, 2, 0, 2, 0, 2, 2, 2, 2, 2, 2, 2, 2, 0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
    2, 0, 2, 0, 2, 0, 2,
  ],
  [
    2, 0, 2, 0, 2, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    2, 0, 2, 0, 2, 0, 2,
  ],
  [
    2, 0, 2, 0, 2, 0, 2, 0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 0,
    2, 0, 2, 0, 2, 0, 2,
  ],
  [
    2, 0, 2, 0, 2, 2, 2, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0,
    2, 0, 2, 0, 2, 0, 2,
  ],
  [
    2, 0, 2, 0, 2, 0, 0, 0, 2, 0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 0, 2, 0,
    2, 0, 2, 0, 2, 0, 2,
  ],
  [
    2, 0, 2, 0, 2, 0, 2, 0, 2, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 2, 0,
    2, 2, 2, 0, 2, 0, 2,
  ],
  [
    2, 0, 2, 0, 2, 0, 2, 0, 2, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 2, 0,
    0, 0, 2, 0, 2, 0, 2,
  ],
  [
    2, 0, 2, 0, 2, 0, 2, 0, 2, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 2, 0,
    2, 0, 2, 0, 2, 0, 2,
  ],
  [
    2, 0, 2, 0, 2, 0, 2, 0, 2, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0,
    2, 0, 2, 0, 0, 0, 2,
  ],
  [
    2, 0, 2, 0, 0, 0, 2, 0, 2, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 2, 2, 0,
    2, 0, 2, 2, 2, 0, 2,
  ],
  [
    2, 0, 2, 2, 2, 2, 2, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 2, 0,
    2, 0, 2, 0, 2, 0, 2,
  ],
  [
    2, 0, 0, 0, 2, 0, 2, 0, 2, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 2, 0,
    2, 0, 2, 0, 2, 0, 2,
  ],
  [
    2, 0, 2, 0, 2, 0, 2, 0, 2, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 2, 0,
    2, 0, 2, 0, 2, 0, 2,
  ],
  [
    2, 0, 2, 0, 2, 0, 2, 0, 2, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 2, 0,
    2, 0, 2, 0, 2, 0, 2,
  ],
  [
    2, 0, 2, 0, 2, 0, 2, 0, 2, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 2, 0,
    2, 0, 2, 0, 2, 0, 2,
  ],
  [
    2, 0, 2, 0, 2, 0, 2, 0, 2, 0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 0, 2, 0,
    2, 0, 2, 0, 2, 0, 2,
  ],
  [
    2, 0, 2, 0, 2, 0, 2, 0, 2, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 2, 0,
    2, 0, 2, 0, 2, 0, 2,
  ],
  [
    2, 0, 2, 0, 2, 0, 2, 0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 0,
    2, 2, 2, 0, 2, 0, 2,
  ],
  [
    2, 0, 2, 0, 2, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 2, 0, 2, 0, 2,
  ],
  [
    2, 0, 2, 0, 2, 0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
    2, 0, 2, 0, 2, 0, 2,
  ],
  [
    2, 0, 2, 0, 2, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 2, 0, 2, 0, 2,
  ],
  [
    2, 0, 2, 0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 0, 2, 2, 2, 2, 2, 2, 2, 2, 2,
    2, 2, 2, 0, 2, 0, 2,
  ],
  [
    3, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 2, 0, 3,
  ],
  [
    3, 0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 0, 2, 2, 2, 2, 2, 2, 2,
    2, 2, 2, 2, 2, 0, 3,
  ],
  [
    4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 4,
  ],
  [
    5, 4, 3, 3, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 0, 0, 3, 2, 2, 2, 2, 2, 2, 2,
    2, 2, 2, 3, 3, 4, 6,
  ],
];

function drawMap() {
  for (x = 0; x < 32; x++) {
    for (y = 0; y < 32; y++) {
      let a = g_map[x][y];
      if (a > 0) {
        var body = new Cube();
        // console.log("texture "+a);
        body.textureNum = a;
        body.matrix.rotate(-40, 0, 1, 0);
        body.matrix.translate(0, 0.25 * a, 0);
        body.matrix.scale(0.5, 0.5 * a, 0.5);
        body.matrix.translate(x - 15.5, 0, y - 15.5);
        body.render();
      }
      if (x == 31 && (y == 15 || y == 16)) {
        var body = new Cube();
        body.textureNum = 1;
        body.matrix.rotate(-40, 0, 1, 0);
        body.matrix.scale(0.5, 0.5, 0.5);
        body.matrix.translate(x - 15.5, 3, y - 15.5);
        body.render();
      }
    }
  }
}

function editMap(i, dir) {
    let x = g_eye.x, y = g_eye.z;
    let mapX = 31 - (x * 2 + 15.5);
    let mapY = 31 - (y * 2 + 15.5);
    let dirX = dir.x, dirY = dir.z;
    
    let roundX, roundY, block;
    let hit = false;
    while(!hit){
        roundX = Math.round(mapX);
        roundY = Math.round(mapY);
        if (roundX > 40  || roundX < -10 || roundY > 40 || roundY < -10){
            hit = true;
            console.log("Failed to edit map. Out of range");
        }
        if (roundX < 32 && roundX > -1 && roundY < 32 && roundY > -1){
            block = g_map[roundX][roundY]
            if (!(i < 0 && block == 0)){
                hit = true;
                if (!(i > 0 && block > 5)){
                    g_map[roundX][roundY] += i;
                }
            }
        }
        x += dirX;
        y += dirY;
        mapX = 31 - (x * 2 + 15.5);
        mapY = 31 - (y * 2 + 15.5);
        // hit = true;
    }

    // if ()
    // console.log("g_map["+mapX+"]["+mapY+"]");
}

// function drawMap() {
//   for (x = 0; x < 32; x++) {
//     for (y = 0; y < 32; y++) {
//       if (x == 0 || x == 32 || y == 0 || y == 32) {
//         drawCube();
//       }
//       else if(x == 2 || y == 2 || x == 29 || y == 29){
//         drawCube();
//       }
//     }
//   }
// }

function drawCube() {
  var body = new Cube();
  body.color = [0.8, 2, 2, 2];
  body.matrix.translate(0, -0.75, 0);
  body.matrix.scale(0.4, 0.4, 0.4);
  body.matrix.translate(x - 26, 0, y - 26);
  body.render();
}

// var g_map = [
//   [2, 2, 2, 2, 2, 2, 2, 2],
//   [2, 0, 0, 0, 0, 0, 0, 2],
//   [2, 0, 0, 0, 0, 0, 0, 2],
//   [2, 0, 0, 2, 2, 0, 0, 2],
//   [2, 0, 0, 0, 0, 0, 0, 2],
//   [2, 0, 0, 0, 0, 0, 0, 2],
//   [2, 0, 0, 0, 2, 0, 0, 2],
//   [2, 0, 0, 0, 0, 0, 0, 2],
// ];

//function drawMap() {
// for (let x = 0; x < 8; x++) {
//   for (let y = 0; y < 8; y++) {
//     if (g_map[x][y] == 2) {
//       var block = new Cube();
//       block.color = [2, 2, 0, 2];
//       block.matrix.translate(x - 4, -0.75, y - 4);
//       block.render();
//     }
//   }
// }
//}
